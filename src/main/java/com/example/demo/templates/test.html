<!DOCTYPE html>
<html lang="zh-CH">
<head>
    <meta charset="UTF-8">
    <title>VLM TEST WEBSITE</title>
</head>
<style>
    .style-btn{
        padding: 8px 16px;
        margin-right:8px;
        border:1px solid#ccc;
        background-color: #f5f5f5;
        cursor:pointer;
    }
    .style-btn.active{
        background-color: #4CAF50;
        color:white;
        border-color:#4CAF50;
        font-weight: bold;
    }
</style>
<body>
<h2>
    VLM  img Analysis
</h2>
//æ–°å¢
<div style="margin-bottom: 10px;">
    <label><input type="radio" name="inputMode" value="upload" checked onclick="toggleInput('upload')"> ä¸Šä¼ å›¾ç‰‡</label>
    <label><input type="radio" name="inputMode" value="draw" onclick="toggleInput('draw')"> åœ¨çº¿ç»˜ç”» (Web Canvas)</label>
</div>

<div id="drawArea" style="display:none; margin-bottom: 20px;">
    <canvas id="myCanvas" width="400" height="300" style="border:2px dashed #ccc; cursor: crosshair;"></canvas>
    <br>
    <button onclick="clearCanvas()">æ¸…ç©ºç”»æ¿</button>
</div>

<div>
    <button class="style-btn active" onclick="setStyle('normal',this)">æ™®é€šåˆ†æ</button>
    <button class="style-btn" onclick="setStyle('detail',this)">è¯¦ç»†åˆ†æ</button>
    <button class="style-btn" onclick="setStyle('kids',this)">å„¿ç«¥è®²è§£</button>
    <button class="style-btn" onclick="setStyle('education_report',this)" style="background-color: #e3f2fd; border-color: #2196f3; color: #0d47a1;">ğŸ“ æ•™è‚²è¯„ä¼°æŠ¥å‘Š</button>
</div>

<input type="file" id="imageInput" accept="image/*"><br><br>
<input type="text" id="promptInput" value="è¿™å¼ å›¾ç‰‡æœ‰ä»€ä¹ˆï¼Ÿ" style="width:300px;"><br><br>
<label>ç³»ç»Ÿæç¤ºè¯ï¼ˆSystem Promptï¼‰ï¼š</label><br>
<textarea id="systemPromptInput"
          rows="3"
          style="width: 400px;">
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å›¾åƒåˆ†æåŠ©æ‰‹ï¼Œè¯·å®¢è§‚ã€è¯¦ç»†åœ°æè¿°å›¾åƒå†…å®¹ã€‚
</textarea>
<br><br>
<div>
    <button class="style-btn active" onclick="setStyle('normal',this)" >æ™®é€šåˆ†æ</button>
    <button  class="style-btn"  onclick="setStyle('detail',this)">è¯¦ç»†åˆ†æ</button>
    <button class="style-btn" onclick="setStyle('kids',this)">å„¿ç«¥è®²è§£</button>
</div>
<br>

<div style="padding: 10px; background-color: #f9f9f9; border: 1px solid #eee;">
    <label><strong>é«˜çº§åˆ†æç»´åº¦ï¼ˆå¯å¤šé€‰ï¼‰ï¼š</strong></label><br>
    <label style="margin-right: 15px; cursor: pointer;">
        <input type="checkbox" id="checkStyle"> ğŸ¨ åˆ†æè‰ºæœ¯é£æ ¼
    </label>
    <label style="margin-right: 15px; cursor: pointer;">
        <input type="checkbox" id="checkEmotion"> ğŸ­ åˆ†ææƒ…ç»ªåº•è‰²
    </label>
</div>
<br>

<button onclick="send()">
    SEND
</button>
<div id="loading" style="display:none;">
    â³ æ­£åœ¨åˆ†æå›¾ç‰‡ï¼Œè¯·ç¨å€™â€¦â€¦
</div>


<pre id="result"></pre>

<script>
    let currentStyle = 'normal';
    function setStyle(style,btn){
        currentStyle = style;

        const buttons = document.querySelectorAll('.style-btn');
        buttons.forEach(b=>b.classList.remove('active'));

        btn.classList.add('active');
    }


    function send(){
        const image = document.getElementById("imageInput").files[0];
        const prompt =document.getElementById("promptInput").value;
        const systemPrompt = document.getElementById("systemPromptInput").value;

        // === æ–°å¢ï¼šè·å–å¤é€‰æ¡†çŠ¶æ€ ===
        const needStyle = document.getElementById("checkStyle").checked;
        const needEmotion = document.getElementById("checkEmotion").checked;

        if(!image){
            alert("choose a picture first!")
            return;
        }


        document.getElementById("loading").style.display = "block";
        document.getElementById("result").textContent = "";


        const formData=new FormData();
        formData.append("image",image);
        formData.append("prompt",prompt);
        formData.append("systemPrompt", systemPrompt);
        formData.append("style", currentStyle);

        // === æ–°å¢ï¼šå°†å¤é€‰æ¡†çŠ¶æ€ä¼ ç»™åç«¯ ===
        formData.append("needStyle", needStyle);
        formData.append("needEmotion", needEmotion);

        fetch("http://localhost:8080/analyze",{
            method:"POST",
            body:formData
        })
            .then(res=> res.text())
            .then(text=> {
                document.getElementById("loading").style.display = "none";
                document.getElementById("result").textContent =text;
            })
            .catch(err=>{
                document.getElementById("loading").style.display = "none";
                document.getElementById("result").textContent =err;
            })
    }

</script>


</body>
</html>